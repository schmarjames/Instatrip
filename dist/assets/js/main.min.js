define(["router"],function(e){var t=function(){new e;Backbone.history.on("all",function(e,t){})};return{initialize:t}}),requirejs.config({paths:{jquery:"../bower_components/jquery/dist/jquery.min",underscore:"../bower_components/underscore/underscore-min",backbone:"../bower_components/backbone/backbone-min",localstorage:"../bower_components/backbone.localStorage/backbone.localStorage",autocomplete:"../node_modules/easy-autocomplete/dist/jquery.easy-autocomplete.min"}}),requirejs(["app"],function(e){e.initialize()}),define(["backbone","views/dashboard","views/main","views/search","views/photoList"],function(e,t,n,i,o){var r;return e.Router.extend({routes:{"":"search",photos:"photos",likedphotos:"likedPhotos"},search:function(){r.transferView().addChildView(new i({parent:r})),r.childView.render()},photos:function(){return void 0===r.collection?void this.navigate("",!0):(r.transferView().addChildView(new o({parent:r,displayLikes:!1})),r.childView.viewState=new e.Model,r.childView.viewState.set({currentPosition:0}),void r.childView.render())},likedPhotos:function(){return 0===r.local.collection.localStorage.records.length?void this.navigate("",!0):(r.transferView().addChildView(new o({parent:r,displayLikes:!0})),r.childView.viewState=new e.Model,r.childView.viewState.set({currentPosition:0}),void r.childView.render())},initialize:function(){r=new n({dashboard:t,navigate:this.navigate}),e.history.start()}})}),define(["module"],function(e){"use strict";var t,n,i,o,r,a=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],l=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,s=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,c="undefined"!=typeof location&&location.href,d=c&&location.protocol&&location.protocol.replace(/\:/,""),u=c&&location.hostname,h=c&&(location.port||void 0),p={},f=e.config&&e.config()||{};return t={version:"2.0.14",strip:function(e){if(e){e=e.replace(l,"");var t=e.match(s);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:f.createXhr||function(){var e,t,n;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(t=0;3>t;t+=1){n=a[t];try{e=new ActiveXObject(n)}catch(i){}if(e){a=[n];break}}return e},parseName:function(e){var t,n,i,o=!1,r=e.lastIndexOf("."),a=0===e.indexOf("./")||0===e.indexOf("../");return-1!==r&&(!a||r>1)?(t=e.substring(0,r),n=e.substring(r+1)):t=e,i=n||t,r=i.indexOf("!"),-1!==r&&(o="strip"===i.substring(r+1),i=i.substring(0,r),n?n=i:t=i),{moduleName:t,ext:n,strip:o}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,i,o){var r,a,l,s=t.xdRegExp.exec(e);return s?(r=s[2],a=s[3],a=a.split(":"),l=a[1],a=a[0],!(r&&r!==n||a&&a.toLowerCase()!==i.toLowerCase()||(l||a)&&l!==o)):!0},finishLoad:function(e,n,i,o){i=n?t.strip(i):i,f.isBuild&&(p[e]=i),o(i)},load:function(e,n,i,o){if(o&&o.isBuild&&!o.inlineText)return void i();f.isBuild=o&&o.isBuild;var r=t.parseName(e),a=r.moduleName+(r.ext?"."+r.ext:""),l=n.toUrl(a),s=f.useXhr||t.useXhr;return 0===l.indexOf("empty:")?void i():void(!c||s(l,d,u,h)?t.get(l,function(n){t.finishLoad(e,r.strip,n,i)},function(e){i.error&&i.error(e)}):n([a],function(e){t.finishLoad(r.moduleName+"."+r.ext,r.strip,e,i)}))},write:function(e,n,i,o){if(p.hasOwnProperty(n)){var r=t.jsEscape(p[n]);i.asModule(e+"!"+n,"define(function () { return '"+r+"';});\n")}},writeFile:function(e,n,i,o,r){var a=t.parseName(n),l=a.ext?"."+a.ext:"",s=a.moduleName+l,c=i.toUrl(a.moduleName+l)+".js";t.load(s,i,function(n){var i=function(e){return o(c,e)};i.asModule=function(e,t){return o.asModule(e,c,t)},t.write(e,s,i,r)},r)}},"node"===f.env||!f.env&&"undefined"!=typeof process&&process.versions&&process.versions.node&&!process.versions["node-webkit"]&&!process.versions["atom-shell"]?(n=require.nodeRequire("fs"),t.get=function(e,t,i){try{var o=n.readFileSync(e,"utf8");"\ufeff"===o[0]&&(o=o.substring(1)),t(o)}catch(r){i&&i(r)}}):"xhr"===f.env||!f.env&&t.createXhr()?t.get=function(e,n,i,o){var r,a=t.createXhr();if(a.open("GET",e,!0),o)for(r in o)o.hasOwnProperty(r)&&a.setRequestHeader(r.toLowerCase(),o[r]);f.onXhr&&f.onXhr(a,e),a.onreadystatechange=function(t){var o,r;4===a.readyState&&(o=a.status||0,o>399&&600>o?(r=new Error(e+" HTTP status: "+o),r.xhr=a,i&&i(r)):n(a.responseText),f.onXhrComplete&&f.onXhrComplete(a,e))},a.send(null)}:"rhino"===f.env||!f.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java?t.get=function(e,t){var n,i,o="utf-8",r=new java.io.File(e),a=java.lang.System.getProperty("line.separator"),l=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(r),o)),s="";try{for(n=new java.lang.StringBuffer,i=l.readLine(),i&&i.length()&&65279===i.charAt(0)&&(i=i.substring(1)),null!==i&&n.append(i);null!==(i=l.readLine());)n.append(a),n.append(i);s=String(n.toString())}finally{l.close()}t(s)}:("xpconnect"===f.env||!f.env&&"undefined"!=typeof Components&&Components.classes&&Components.interfaces)&&(i=Components.classes,o=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),r="@mozilla.org/windows-registry-key;1"in i,t.get=function(e,t){var n,a,l,s={};r&&(e=e.replace(/\//g,"\\")),l=new FileUtils.File(e);try{n=i["@mozilla.org/network/file-input-stream;1"].createInstance(o.nsIFileInputStream),n.init(l,1,0,!1),a=i["@mozilla.org/intl/converter-input-stream;1"].createInstance(o.nsIConverterInputStream),a.init(n,"utf-8",n.available(),o.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),a.readString(n.available(),s),a.close(),n.close(),t(s.value)}catch(c){throw new Error((l&&l.path||"")+": "+c)}}),t}),define(["backbone","localstorage"],function(e,t){var n=e.Collection.extend({localStorage:new e.LocalStorage("InstatripData"),initialize:function(){var e=this;this.localStorage.findAll().forEach(function(t){e.add(t)})}});return n}),define(["backbone"],function(e){var t=e.Collection.extend({url:"",initialize:function(e){this.tag=e.tagName},sync:function(t,n,i){return i.dataType="jsonp",e.sync(t,n,i)},parse:function(e){return e.data}});return t}),define(["backbone","localstorage"],function(e,t){var n=e.Model.extend({defaults:function(){return{id:"",url:"",likeStatus:"",likesTotal:""}}});return n}),define(["jquery","underscore","backbone","../text!../templates/dashboard.html"],function(e,t,n,i){var o=n.View.extend({el:e("#wrapper"),initialize:function(e){this.local=e.local,this.navigate=e.navigate,this.render()},render:function(){this.$el.find("#dashboard").length>0&&this.$el.find("#dashboard").remove();var n=this.local.collection.localStorage.records.length,o=n>0?n:0,r=t.template(i),a=r({liketotal:o});e(this.el).prepend(a)},events:{"click button.like":"displayLikedPhotos"},displayLikedPhotos:function(e){return e.preventDefault(),this.local.collection.localStorage.records.length>0?void this.navigate("likedphotos",!0):void 0}});return o}),define(["backbone","collection/local","models/local"],function(e,t,n){var i=e.View.extend({el:"#wrapper",childView:null,template:null,local:{collection:null,model:null},initialize:function(e){this.local.collection=new t,this.navigate=e.navigate,this.dashboard=new e.dashboard(this)},addChildView:function(e){var t=this.$el.find("#dashboard");this.$el.html(t),this.childView=e,this.childView.on("likeChange",this.dashboard.render,this)},transferView:function(){return null!==this.childView&&(this.childView.undelegateEvents(),this.childView.stopListening(),this.childView.unbind(),this.$el.children().not("#dashboard").fadeOut(500,function(e){$(this).remove()})),this},render:function(){}});return i}),define(["jquery","underscore","backbone","../models/local","../text!../templates/photoList.html"],function(e,t,n,i,o){var r=n.View.extend({el:e("#wrapper"),initialize:function(e){this.parent=e.parent,this.displayLikes=e.displayLikes,this.on("likeChange",this.render,this)},render:function(){this.$el.children().not("#dashboard").remove();var e=this,n=[];this.displayLikes?(like_ids=this.parent.local.collection.localStorage.records,like_ids.forEach(function(t,i){var o=(void 0!==e.parent.local.collection.models[i].attributes?e.parent.local.collection.models[i].attributes:e.parent.local.collection.models[i],e.generatePhotoObj(e.parent.local.collection.models[i].attributes));o.index=i,n.push(o)})):this.parent.collection.each(function(t,i){var o,r=t.attributes;o=e.generatePhotoObj(r),o.index=i,n.push(o)});var i=t.template(o),r=i({_:t,photos:n,count:0});this.$el.append(r),this.$el.find("#photo-list-wrapper").scrollTop(this.viewState.get("currentPosition"))},generatePhotoObj:function(e){var t={};return t.url=void 0!==e.images?e.images.standard_resolution.url:e.url,t.id=e.id,t.likeStatus=this.isLiked(e.id),t.likesTotal=void 0!==e.likes?e.likes.count:e.likesTotal,t},isLiked:function(e){for(var t=this.parent.local.collection.localStorage.records,n=0;n<=t.length;n++)if(t[n]==e)return!0;return!1},events:{"click a.like-photo":"toggleLike"},toggleLike:function(t){t.preventDefault();var n=this,o=e(t.currentTarget),r=o.parents("#photo-list-wrapper"),a=o.parents(".image-section").attr("data-id"),l=o.parents(".image-section").attr("data-index");if(this.isLiked(a)){var s=this.parent.local.collection.localStorage;if(this.parent.local.collection.each(function(e){void 0!=e&&e.id==a&&(s.destroy(e),n.parent.local.collection.remove(e))}),this.viewState.set({currentPosition:r.scrollTop()}),this.trigger("likeChange"),this.displayLikes&&0===s.records.length)return void this.parent.navigate("",!0)}else{var c=this.parent.collection.models[l].attributes,d=new i(this.generatePhotoObj(c));this.parent.local.collection.add(d),this.parent.local.collection.localStorage.create(d),this.parent.local.collection.localStorage.save(),this.viewState.set({currentPosition:r.scrollTop()}),this.trigger("likeChange")}}});return r}),define(["jquery","autocomplete","underscore","backbone","../collection/photographers","../text!../templates/search.html"],function(e,t,n,i,o,r){var a=i.View.extend({el:e("#wrapper"),template:null,photographers:null,parent:null,initialize:function(e){this.parent=e.parent},render:function(){var t=this,i=n.template(r),o=i({});$target_fade=this.$el.children().not("#dashboard").length>0?this.$el.children():this.$el,$target_fade.not("#dashboard").fadeOut(500,function(){t.$el.append(o),t.photographers={data:["everythingeverywhere","lozula","elialocardi","lostncheeseland"]},e(t.el).find("#photo-search").easyAutocomplete(t.photographers)}).fadeIn(500)},events:{"click #search-form .submit":"searchPhotographer"},searchPhotographer:function(t){t.preventDefault();var n=this,i=e(t.currentTarget),r=i.parent().find("#photo-search").val();this.photographers.data.indexOf(r)>-1&&(photographers=new o({tagName:r}),photographers.url="https://api.instagram.com/v1/tags/"+r+"/media/recent?client_id=6c2064d60740476fbe93292ded2d69a7&callback=?",photographers.fetch().done(function(e){n.parent.collection=photographers,n.parent.navigate("photos",!0)}))}});return a});